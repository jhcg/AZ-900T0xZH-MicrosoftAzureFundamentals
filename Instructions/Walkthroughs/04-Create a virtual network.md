---
wts:
    title: '04 - 创建虚拟网络（20 分钟）'
    module: '模块 02 - 核心 Azure 服务（工作负载）'
---
# 04 - 创建虚拟网络（20 分钟）

在本演练中，我们将创建一个虚拟网络，将两个虚拟机部署到该虚拟网络上，然后配置它们以允许一个虚拟机通过该虚拟网络 ping 至另一个虚拟机。

# 任务 1：创建虚拟网络 

在此任务中，我们将创建虚拟网络。 

1. 登录 Azure 门户：<a href="https://portal.azure.com" target="_blank"><span style="color: #0066cc;" color="#0066cc">https://portal.azure.com</span></a>

2. 从“**所有服务**”边栏选项卡，搜索并选择“**虚拟网络**”，然后单击“**+ 添加**”、“**+ 创建**”、“**+ 新建**”。 

3. 在“**基本**”选项卡上，填写以下信息（其他所有设置保留默认值）：

    | 设置 | 值 | 
    | --- | --- |
    | 订阅 | **保留提供的默认值** |
    | 资源组 | **创建新的资源组** |
    | 名称 | **vnet1** |
    | 区域 | **（美国）美国东部** |
    
   
4. 单击“**查看 + 创建**”按钮。确保验证通过。


# 任务 2：创建两个虚拟机

在此任务中，我们将在虚拟网络中创建两个虚拟机。 

1. 在“**所有服务**”边栏选项卡中，搜索“**虚拟机**”，然后单击“**+ 添加**”、“**+ 创建**”、“**+ 新建**”，从下拉列表中选择“**虚拟机**”。 

2. 在“**基本**”选项卡上，填写以下信息（其他所有设置保留默认值）：

   | 设置 | 值 | 
   | --- | --- |
   | 订阅 | **使用提供的默认值** |
   | 资源组 |  **选择下拉列表中的默认值** |
   | 虚拟机名称 | **vm1**|
   | 区域 | **（美国）美国东部** |
   | 映像 | **Windows Server 2019 Datacenter - Gen1** |
   | 用户名| **azureuser** |
   | 密码| **Pa$$w0rd1234** |
   | 公共入站端口| 选择“**允许选定的端口**” |
   | 选定的入站端口| **RDP (3389)** |
   

3. 选择“**网络**”选项卡。确保虚拟机位于 **vnet1** 虚拟网络中。查看默认设置，但不要进行任何其他更改。 

4. 单击“**查看 + 创建**”。验证通过后，单击“**创建**”。部署时间可能有所不同，通常需要三到六分钟才能完成部署。

5. 监视你的部署，同时继续执行下一步。 

6. 通过重复上述步骤 **2 至 4** 创建第二个虚拟机。请务必使用其他虚拟机名称，并确保该虚拟机位于同一虚拟网络中，并且使用新的公共 IP 地址：

    | 设置 | 值 |
    | --- | --- |
    | 资源组 | **myRGVNet** |
    | 虚拟机名称 |  **vm2** |
    | 虚拟网络 | **vnet1** |
    | 公共 IP | **vm2-ip** |

7. 等待两台虚拟机部署完毕，状态显示“*正在运行*”。

# 任务 3：测试连接 

在此任务中，我们将尝试测试虚拟机能否相互通信 (ping)。如果无法相互通信，我们将安装一个规则以允许 ICMP 连接。通常，ICMP 连接会被自动阻止。

1. 在 **“所有资源”** 边栏选项卡中，搜索 **“vm1”**，打开其 **“概述”** 边栏选项卡，并确保其 **“状态”** 为 **“正在运行”**。你可能需要**刷新**页面。

2. 在“**概述**”边栏选项卡上，选择“**连接**”并从下拉列表选择“**RDP**”。

    **备注**： 以下说明介绍如何从 Windows 计算机连接到 VM。 

3. 在“**连接 RDP**”边栏选项卡上，保留默认选项，按 IP 地址通过端口 3389 进行连接，然后单击“**下载 RDP 文件**”。

4. 打开下载的 RDP 文件（位于 VM 的左下角）并在出现提示时单击“**连接**”。 

5. 在“**Windows 安全**”窗口中，键入用户名“**azureuser**”和密码“**Pa$$w0rd1234**”，然后单击“**确定**”。

6. 在登录过程中，你可能会收到证书警告。单击“**是**”以创建连接并连接到已部署的 VM。你应该成功连接。关闭弹出的 Windows Server 和仪表板窗口。你应该会看到蓝色的 Windows 背景。现在你已处于虚拟机中。

7. 通过单击“**开始**”按钮在虚拟机上打开 PowerShell，然后在搜索类型 PowerShell 中，右键单击“**Windows PowerShell**”并选择“**以管理员身份运行**”

8. 在 Powershell 中，尝试通过键入以下命令来 ping 到 vm2：

   ```PowerShell
   ping vm2
   ```

 9. 现在应尝试成功。你已从 VM1 ping 到 VM2。


**恭喜！** 你已经在虚拟网络中配置并部署了两个虚拟机，然后可以连接它们了。

**备注**：为避免产生额外费用，你可以根据需要删除此资源组。搜索资源组，单击你的资源组，然后单击“**删除资源组**”。验证资源组的名称，然后单击“**删除**”。关注“**通知**”，了解删除操作的进度。
